// prisma/schema.prisma - ATUALIZADO para suportar User Stories 1, 2 e 3
generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Item {
  id        Int     @id @default(autoincrement())
  title     String
}

model Product {
  id          Int      @id @default(autoincrement())
  name        String
  unitPrice   Float?   // NOVO - preço por unidade (US1)
  kgPrice     Float?   // NOVO - preço por kg (US1)
  price       Float?   // MANTER para compatibilidade, mas será deprecated
  category    String?
  description String?  // NOVO - descrição do produto (US1)
  imageUrl    String?  // URL da imagem do produto
  createdAt   DateTime @default(now())
  
  saleItems   SaleItem[]
}

model PaymentMethod {
  id       Int    @id @default(autoincrement())
  name     String @unique
  taxRate  Float  // Taxa em percentual (US2: crédito 4,79%, débito 1,99%, Pix 0%)
  
  sales Sale[]
}

model Sale {
  id              Int           @id @default(autoincrement())
  totalGross      Float         // Total bruto conforme fluxo BPMN
  totalTax        Float         // Total em taxas conforme fluxo BPMN
  totalNet        Float         // Total líquido conforme fluxo BPMN
  paymentMethodId Int
  receivedAmount  Float?        // NOVO - valor recebido do cliente
  changeAmount    Float?        // NOVO - troco dado ao cliente
  createdAt       DateTime      @default(now())
  
  paymentMethod PaymentMethod @relation(fields: [paymentMethodId], references: [id])
  items         SaleItem[]
}

model SaleItem {
  id          Int   @id @default(autoincrement())
  quantity    Int   // Quantidade do produto
  weight      Float? // NOVO - peso para produtos vendidos por kg
  unitPrice   Float? // NOVO - preço unitário no momento da venda
  kgPrice     Float? // NOVO - preço por kg no momento da venda  
  price       Float  // MANTER para compatibilidade
  subtotal    Float  // Subtotal do item
  
  productId   Int
  saleId      Int
  
  product Product @relation(fields: [productId], references: [id])
  sale    Sale    @relation(fields: [saleId], references: [id])
}
